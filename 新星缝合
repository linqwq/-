local success, Rayfield = pcall(function()
    return loadstring(game:HttpGet("https://sirius.menu/rayfield"))()
end)
if not success then
    warn("加载失败")
    return
end

local RunService = game:GetService("RunService")
local Players = game:GetService("Players")
local UIS = game:GetService("UserInputService")
local lp = Players.LocalPlayer
local playerGui = lp:WaitForChild("PlayerGui")


local ESPEnabled = false
local AimbotEnabled = false
local NoclipEnabled = false
local Flying = false
local HitboxExpandEnabled = false

local flySpeed = 50
local walkSpeed = 16
local jumpPower = 50
local aimbotFOV = 100
local hitboxSize = 5

local espItems = {}
local aimbotConnection
local flyBV, flyBG, flyingHeartbeat

local Window = Rayfield:CreateWindow({
    Name = "星新缝合",
    LoadingTitle = "星新缝合",
    ConfigurationSaving = { Enabled = true, FolderName = "UniversalHub", FileName = "Settings" }
})

local MainTab = Window:CreateTab("主要")


local fovGui = Instance.new("ScreenGui", playerGui)
fovGui.Name = "FOVGui"
fovGui.ResetOnSpawn = false

local fovFrame = Instance.new("Frame", fovGui)
fovFrame.Size = UDim2.new(0, aimbotFOV * 2, 0, aimbotFOV * 2)
fovFrame.BackgroundTransparency = 1
fovFrame.BorderColor3 = Color3.new(1, 1, 1)
fovFrame.BorderSizePixel = 2
fovFrame.AnchorPoint = Vector2.new(0.5, 0.5)
fovFrame.Position = UDim2.new(0.5, 0, 0.5, 0)
fovFrame.Visible = false

local fovCircle = Instance.new("ImageLabel", fovGui)
fovCircle.Size = fovFrame.Size
fovCircle.BackgroundTransparency = 1
fovCircle.Image = "rbxassetid://1270305386"
fovCircle.ImageColor3 = Color3.new(1, 1, 1)
fovCircle.ImageTransparency = 0.5
fovCircle.AnchorPoint = Vector2.new(0.5, 0.5)
fovCircle.Position = UDim2.new(0.5, 0, 0.5, 0)
fovCircle.Visible = false


local function getCharPart(char)
    return char:FindFirstChild("UpperTorso") or char:FindFirstChild("Torso") or char:FindFirstChild("HumanoidRootPart")
end

local function createESP(plr)
    local char = plr.Character
    if not char then return end
    local part = getCharPart(char)
    if not part then return end


    local box = Instance.new("BoxHandleAdornment")
    box.Adornee = part
    box.AlwaysOnTop = true
    box.ZIndex = 10
    box.Transparency = 0.5
    box.Size = Vector3.new(4, 6, 2)
    box.Color3 = Color3.new(1, 0, 0)
    box.Parent = workspace.CurrentCamera


    local nameGui = Instance.new("BillboardGui")
    nameGui.Adornee = part
    nameGui.Size = UDim2.new(0, 100, 0, 40)
    nameGui.StudsOffset = Vector3.new(0, 3, 0)
    nameGui.AlwaysOnTop = true
    nameGui.Parent = workspace.CurrentCamera

    local nameLabel = Instance.new("TextLabel", nameGui)
    nameLabel.BackgroundTransparency = 1
    nameLabel.Size = UDim2.new(1, 0, 1, 0)
    nameLabel.Text = plr.Name
    nameLabel.TextColor3 = Color3.new(1, 1, 1)
    nameLabel.TextStrokeTransparency = 0
    nameLabel.TextScaled = true
    nameLabel.Font = Enum.Font.GothamBold

    return {Box = box, NameGui = nameGui}
end

local function clearESP()
    for _, esp in pairs(espItems) do
        if esp.Box then esp.Box:Destroy() end
        if esp.NameGui then esp.NameGui:Destroy() end
    end
    espItems = {}
end

local function updateESP()
    -- Cleanup dead players or removed characters
    for plr, esp in pairs(espItems) do
        if not plr.Character or not plr.Character:FindFirstChildOfClass("Humanoid") or plr.Character.Humanoid.Health <= 0 then
            if esp.Box then esp.Box:Destroy() end
            if esp.NameGui then esp.NameGui:Destroy() end
            espItems[plr] = nil
        end
    end
    -- Add ESP to alive players without one
    for _, plr in pairs(Players:GetPlayers()) do
        if plr ~= lp and plr.Character and plr.Character:FindFirstChildOfClass("Humanoid") and plr.Character.Humanoid.Health > 0 then
            if not espItems[plr] then
                espItems[plr] = createESP(plr)
            end
        end
    end
end

local function getClosest(maxDist)
    local mouse = UIS:GetMouseLocation()
    local closest, oortest = nil, maxDist
    for _, plr in pairs(Players:GetPlayers()) do
        if plr ~= lp and plr.Character and plr.Character:FindFirstChild("Head") and plr.Character:FindFirstChildOfClass("Humanoid") and plr.Character.Humanoid.Health > 0 then
            local pos, onScreen = workspace.CurrentCamera:WorldToViewportPoint(plr.Character.Head.Position)
            if onScreen then
                local dist = (Vector2.new(pos.X, pos.Y) - Vector2.new(mouse.X, mouse.Y)).Magnitude
                if dist < shortest then
                    shortest = dist
                    closest = plr
                end
            end
        end
    end
    return closest
end

local function toggleAimbot(val)
    AimbotEnabled = val
    fovCircle.Visible = val
    fovFrame.Visible = val
    if val and not aimbotConnection then
        aimbotConnection = RunService.RenderStepped:Connect(function()
            fovCircle.Size = UDim2.new(0, aimbotFOV * 2, 0, aimbotFOV * 2)
            fovFrame.Size = fovCircle.Size
            if UIS:IsMouseButtonPressed(Enum.UserInputType.MouseButton2) then
                local target = getClosest(aimbotFOV)
                if target and target.Character and target.Character:FindFirstChild("Head") then
                    local cam = workspace.CurrentCamera
                    cam.CFrame = CFrame.new(cam.CFrame.Position, target.Character.Head.Position)
                end
            end
        end)
    elseif not val and aimbotConnection then
        aimbotConnection:Disconnect()
        aimbotConnection = nil
    end
end

local flyBV, flyBG, flyingHeartbeat

local function toggleFly(val)
    Flying = val
    if val then
        local char = lp.Character
        if char and char:FindFirstChild("HumanoidRootPart") then
            local hrp = char.HumanoidRootPart
            flyBV = Instance.new("BodyVelocity", hrp)
            flyBV.MaxForce = Vector3.new(1e5, 1e5, 1e5)
            flyBG = Instance.new("BodyGyro", hrp)
            flyBG.MaxTorque = Vector3.new(1e5, 1e5, 1e5)
            flyBG.P = 1000
            flyBG.CFrame = hrp.CFrame
            flyingHeartbeat = RunService.Heartbeat:Connect(function()
                local dir = Vector3.new()
                local cam = workspace.CurrentCamera
                if UIS:IsKeyDown(Enum.KeyCode.W) then dir += cam.CFrame.LookVector end
                if UIS:IsKeyDown(Enum.KeyCode.S) then dir -= cam.CFrame.LookVector end
                if UIS:IsKeyDown(Enum.KeyCode.A) then dir -= cam.CFrame.RightVector end
                if UIS:IsKeyDown(Enum.KeyCode.D) then dir += cam.CFrame.RightVector end
                if UIS:IsKeyDown(Enum.KeyCode.Q) then dir += Vector3.new(0, -1, 0) end
                if UIS:IsKeyDown(Enum.KeyCode.E) then dir += Vector3.new(0, 1, 0) end
                flyBV.Velocity = dir.Magnitude > 0 and dir.Unit * flySpeed or Vector3.zero
                flyBG.CFrame = cam.CFrame
            end)
        end
    else
        if flyingHeartbeat then flyingHeartbeat:Disconnect() end
        if flyBV then flyBV:Destroy() end
        if flyBG then flyBG:Destroy() end
    end
end

RunService.Stepped:Connect(function()
    if lp.Character then
        for _, part in ipairs(lp.Character:GetDescendants()) do
            if part:IsA("BasePart") then
                part.CanCollide = not NoclipEnabled
            end
        end
    end
end)

local function applyHitbox(size)
    for _, plr in pairs(Players:GetPlayers()) do
        if plr ~= lp and plr.Character then
            local hrp = plr.Character:FindFirstChild("HumanoidRootPart")
            if hrp then
                hrp.Size = Vector3.new(size, size, size)
                hrp.Transparency = 0.5
                hrp.CanCollide = false
            end
        end
    end
end


MainTab:CreateToggle({
    Name = "透视(人物与名称)",
    CurrentValue = false,
    Callback = function(v)
        ESPEnabled = v
    end
})

MainTab:CreateToggle({
    Name = "瞄准机器人",
    CurrentValue = false,
    Callback = toggleAimbot
})

MainTab:CreateSlider({
    Name = "瞄准机器人FOV",
    Range = {50, 300},
    Increment = 5,
    CurrentValue = aimbotFOV,
    Callback = function(v)
        aimbotFOV = v
        fovCircle.Size = UDim2.new(0, v * 2, 0, v * 2)
        fovFrame.Size = fovCircle.Size
    end
})

MainTab:CreateToggle({
    Name = "飞行(上Q/下E PC)",
    CurrentValue = false,
    Callback = toggleFly
})

MainTab:CreateSlider({
    Name = "飞行速度",
    Range = {10, 300},
    Increment = 5,
    CurrentValue = flySpeed,
    Callback = function(v)
        flySpeed = v
    end
})

MainTab:CreateSlider({
    Name = "行走速度",
    Range = {16, 250},
    Increment = 1,
    CurrentValue = walkSpeed,
    Callback = function(v)
        walkSpeed = v
        local hum = lp.Character and lp.Character:FindFirstChildOfClass("Humanoid")
        if hum then
            hum.WalkSpeed = v
        end
    end
})

MainTab:CreateSlider({
    Name = "跳高距离",
    Range = {50, 300},
    Increment = 5,
    CurrentValue = jumpPower,
    Callback = function(v)
        jumpPower = v
        local hum = lp.Character and lp.Character:FindFirstChildOfClass("Humanoid")
        if hum then
            hum.UseJumpPower = true
            hum.JumpPower = v
        end
    end
})

MainTab:CreateToggle({
    Name = "启动跳高",
    CurrentValue = false,
    Callback = function(v)
        NoclipEnabled = v
    end
})

MainTab:CreateToggle({
    Name = "碰撞箱扩展器",
    CurrentValue = false,
    Callback = function(v)
        HitboxExpandEnabled = v
        if v then
            applyHitbox(hitboxSize)
        else
            applyHitbox(2)
        end
    end
})

MainTab:CreateSlider({
    Name = "碰撞箱大小",
    Range = {2, 10},
    Increment = 0.5,
    CurrentValue = hitboxSize,
    Callback = function(v)
        hitboxSize = v
        if HitboxExpandEnabled then
            applyHitbox(v)
        end
    end
})

RunService.Heartbeat:Connect(function()
    if ESPEnabled then
        updateESP()
    else
        clearESP()
    end
end)


local MainTab = Window:CreateTab("公告 不看sm")

local Button = MainTab:CreateButton({
 
	Name = "复制QQ群(没进的给我进)",
 
	Callback = function()
 
     setclipboard("1055767342")
 
  	end
 
})
 
local Button = MainTab:CreateButton({
 
	Name = "复制作者快手(不给我关注等着晚上来偷你家)",
 
	Callback = function()
 
     setclipboard("4667322781")
 
  	end
 
})

local MainTab = Window:CreateTab("蜂群")

local Button = MainTab:CreateButton({
   Name = "蜂群1",
   Callback = function()
loadstring(game:HttpGet("https://raw.githubusercontent.com/Chris12089/atlasbss/main/script.lua"))()
   end,
})

local Button = MainTab:CreateButton({
   Name = "蜂群2",
   Callback = function()
loadstring(game:HttpGet("https://pastefy.app/oNgK4F7g/raw"))()
   end,
})


local MainTab = Window:CreateTab("种植花园")

local Button = MainTab:CreateButton({
   Name = "种植花园1",
   Callback = function()
loadstring(game:HttpGet('https://zaphub.xyz/Exec'))()
   end,
})

local Button = MainTab:CreateButton({
   Name = "种植花园2",
   Callback = function()
loadstring(game:HttpGet('https://raw.githubusercontent.com/IsThisMe01/Project-Madara/refs/heads/main/loader.lua'))();
   end,
})


local MainTab = Window:CreateTab("被遗弃")

local Button = MainTab:CreateButton({
   Name = "被遗弃1",
   Callback = function()
loadstring(game:HttpGet("https://raw.githubusercontent.com/TheOther1211/encrypted.luau/refs/heads/main/luau.lua"))()
   end,
})

local Button = MainTab:CreateButton({
   Name = "被遗弃2",
   Callback = function()
loadstring(game:HttpGet("https://raw.githubusercontent.com/LolnotaKid/project/refs/heads/main/AutoBLOCKKKWAHV1"))()
   end,
})

local Button = MainTab:CreateButton({
   Name = "被遗弃3",
   Callback = function()
loadstring(game:HttpGet("https://raw.githubusercontent.com/Snowt69/SNT-HUB/refs/heads/main/Forsaken"))()
   end,
})


local MainTab = Window:CreateTab("钓鱼吧")

local Button = MainTab:CreateButton({
   Name = "钓鱼吧1",
   Callback = function()
loadstring(game:HttpGet("https://pastebin.com/raw/Xiqw3ujD",true))()
   end,
})


local MainTab = Window:CreateTab("最强战场")

local Button = MainTab:CreateButton({
   Name = "最强战场1",
   Callback = function()
loadstring(game:HttpGet("https://raw.githubusercontent.com/Trustmenotcondom/QTONYX/refs/heads/main/QuantumOnyx.lua"))()
   end,
})
